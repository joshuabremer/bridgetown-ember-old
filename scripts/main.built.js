ger("render"),this.renderCollection(),this.trigger("composite:rendered"),this},renderCollection:function(){r.CollectionView.prototype.render.apply(this,arguments),this.trigger("composite:collection:rendered")},renderModel:function(){var e={};e=this.serializeData();var t=this.getTemplate();return r.Renderer.render(t,e)},appendHtml:function(e,t){var n=this.getItemViewContainer(e);n.append(t.el)},getItemViewContainer:function(e){var n;if("$itemViewContainer"in e)n=e.$itemViewContainer;else{if(e.itemViewContainer){n=e.$(t.result(e,"itemViewContainer"));if(n.length<=0){var r=new Error("Missing `itemViewContainer`");throw r.name="ItemViewContainerMissingError",r}}else n=e.$el;e.$itemViewContainer=n}return n},resetItemViewContainer:function(){this.$itemViewContainer&&delete this.$itemViewContainer
}}),r.Region=function(e){this.options=e||{};var n=new r.EventBinder;t.extend(this,n,e);if(!this.el){var i=new Error("An 'el' must be specified");throw i.name="NoElError",i}this.initialize&&this.initialize.apply(this,arguments)},t.extend(r.Region.prototype,e.Events,{show:function(e){this.ensureEl(),this.close(),e.render(),this.open(e),e.onShow&&e.onShow(),e.trigger("show"),this.onShow&&this.onShow(e),this.trigger("view:show",e),this.currentView=e},ensureEl:function(){if(!this.$el||this.$el.length===0)this.$el=this.getEl(this.el)},getEl:function(e){return n(e)},open:function(e){this.$el.html(e.el)},close:function(){var e=this.currentView;if(!e)return;e.close&&e.close(),this.trigger("view:closed",e),delete this.currentView},attachView:function(e){this.currentView=e},reset:function(){this.close(),delete this.$el}}),r.Region.extend=e.View.extend,r.Layout=r.ItemView.extend({regionType:r.Region,constructor:function(){e.Marionette.ItemView.apply(this,arguments),this.initializeRegions()},render:
function(){var e=r.ItemView.prototype.render.apply(this,arguments);return this.render=function(){this.closeRegions(),this.reInitializeRegions();var e=r.ItemView.prototype.render.apply(this,arguments);return e},e},close:function(){this.closeRegions(),this.destroyRegions(),e.Marionette.ItemView.prototype.close.call(this,arguments)},initializeRegions:function(){this.regionManagers||(this.regionManagers={});var e=this;t.each(this.regions,function(t,n){if(typeof t!="string"&&typeof t.selector!="string")throw new Exception("Region must be specified as a selector string or an object with selector property");var r=typeof t=="string"?t:t.selector,i=typeof t.regionType=="undefined"?e.regionType:t.regionType,s=new i({el:r,getEl:function(t){return e.$(t)}});e.regionManagers[n]=s,e[n]=s})},reInitializeRegions:function(){this.regionManagers&&t.size(this.regionManagers)===0?this.initializeRegions():t.each(this.regionManagers,function(e){e.reset()})},closeRegions:function(){var e=this;t.each(this.regionManagers
,function(e,t){e.close()})},destroyRegions:function(){var e=this;t.each(this.regionManagers,function(t,n){delete e[n]}),this.regionManagers={}}}),r.Application=function(e){this.initCallbacks=new r.Callbacks,this.vent=new r.EventAggregator,this.submodules={};var n=new r.EventBinder;t.extend(this,n,e)},t.extend(r.Application.prototype,e.Events,{addInitializer:function(e){this.initCallbacks.add(e)},start:function(e){this.trigger("initialize:before",e),this.initCallbacks.run(e,this),this.trigger("initialize:after",e),this.trigger("start",e)},addRegions:function(e){var t,n,i;for(i in e)e.hasOwnProperty(i)&&(t=e[i],typeof t=="string"?n=new r.Region({el:t}):n=new t,this[i]=n)},removeRegion:function(e){this[e].close(),delete this[e]},module:function(e,t){var n=i.call(arguments);return n.unshift(this),r.Module.create.apply(r.Module,n)}}),r.Application.extend=e.View.extend,r.AppRouter=e.Router.extend({constructor:function(t){e.Router.prototype.constructor.call(this,t);if(this.appRoutes){var n=this
.controller;t&&t.controller&&(n=t.controller),this.processAppRoutes(n,this.appRoutes)}},processAppRoutes:function(e,n){var r,i,s,o,u,a=[],f=this;for(s in n)n.hasOwnProperty(s)&&a.unshift([s,n[s]]);o=a.length;for(u=0;u<o;u++){s=a[u][0],i=a[u][1],r=e[i];if(!r){var l="Method '"+i+"' was not found on the controller",c=new Error(l);throw c.name="NoMethodError",c}r=t.bind(r,e),f.route(s,i,r)}}}),r.Module=function(e,n,i){this.moduleName=e,this.submodules={},this._setupInitializersAndFinalizers(),this._config={},this._config.app=n,this._config.customArgs=i,this._config.definitions=[];var s=new r.EventBinder;t.extend(this,s)},t.extend(r.Module.prototype,e.Events,{addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(e){if(this._isInitialized)return;this._runModuleDefinition(),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.submodules&&t.each(this.submodules,function(t){t.start(e)})},stop:function(
){if(!this._isInitialized)return;this._isInitialized=!1,this._finalizerCallbacks.run(),this._setupInitializersAndFinalizers(),t.each(this.submodules,function(e){e.stop()})},addDefinition:function(e){this._config.definitions.push(e)},_runModuleDefinition:function(){if(this._config.definitions.length===0)return;var i=t.flatten([this,this._config.app,e,r,n,t,this._config.customArgs]),s=this._config.definitions.length-1;for(var o=0;o<=s;o++){var u=this._config.definitions[o];u.apply(this,i)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new r.Callbacks,this._finalizerCallbacks=new r.Callbacks}}),t.extend(r.Module,{create:function(e,n,s){var o=this,u=e;n=n.split(".");var a=i.apply(arguments);a.splice(0,3);var f=n.length;return t.each(n,function(t,n){var i=n===f-1,l=u[t];l||(l=new r.Module(t,e,a),u[t]=l,u.submodules[t]=l),i&&o._createModuleDefinition(l,s,e),u=l}),u},_createModuleDefinition:function(e,t,n){var r=this._getModuleDefinitionOptions(t);r.definition&&e.addDefinition
(r.definition),r.startWithApp&&n.addInitializer(function(t){e.start(t)})},_getModuleDefinitionOptions:function(e){var n={startWithApp:!0};return e?(t.isFunction(e)?n.definition=e:(n.definition=e.define,e.hasOwnProperty("startWithApp")&&(n.startWithApp=e.startWithApp)),n):n}}),r.TemplateCache=function(e){this.templateId=e},t.extend(r.TemplateCache,{templateCaches:{},get:function(e){var t=this,n=this.templateCaches[e];return n||(n=new r.TemplateCache(e),this.templateCaches[e]=n),n.load()},clear:function(){var e,t=arguments.length;if(t>0)for(e=0;e<t;e++)delete this.templateCaches[arguments[e]];else this.templateCaches={}}}),t.extend(r.TemplateCache.prototype,{load:function(){var e=this;if(this.compiledTemplate)return this.compiledTemplate;var t=this.loadTemplate(this.templateId);return this.compiledTemplate=this.compileTemplate(t),this.compiledTemplate},loadTemplate:function(e){var t=n(e).html();if(!t||t.length===0){var r="Could not find template: '"+e+"'",i=new Error(r);throw i.name="NoTemplateError"
,i}return t},compileTemplate:function(e){return t.template(e)}}),r.Renderer={render:function(e,t){var n=typeof e=="function"?e:r.TemplateCache.get(e),i=n(t);return i}},r.Callbacks=function(){this.deferred=n.Deferred(),this.promise=this.deferred.promise()},t.extend(r.Callbacks.prototype,{add:function(e,t){this.promise.done(function(n,r){t&&(n=t),e.call(n,r)})},run:function(e,t){this.deferred.resolve(t,e)}}),r.EventAggregator=r.EventBinder.extend({constructor:function(e){r.EventBinder.apply(this,arguments),t.extend(this,e)},bindTo:function(e,t,n){return r.EventBinder.prototype.bindTo.call(this,this,e,t,n)}}),t.extend(r.EventAggregator.prototype,e.Events),r.EventAggregator.extend=e.View.extend;var i=Array.prototype.slice;return r}(Backbone,_,window.jQuery||window.Zepto||window.ender),define("marionette",["backbone"],function(e){return function(){return e.Backbone.Marionette}}(this)),define("vent",["marionette"],function(e){return new e.EventAggregator}),function(){function n(){return((1+Math
.random())*65536|0).toString(16).substring(1)}function r(){return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}var e=this._,t=this.Backbone;t.LocalStorage=window.Store=function(e){this.name=e;var t=this.localStorage().getItem(this.name);this.records=t&&t.split(",")||[]},e.extend(t.LocalStorage.prototype,{save:function(){this.localStorage().setItem(this.name,this.records.join(","))},create:function(e){return e.id||(e.id=r(),e.set(e.idAttribute,e.id)),this.localStorage().setItem(this.name+"-"+e.id,JSON.stringify(e)),this.records.push(e.id.toString()),this.save(),e.toJSON()},update:function(t){return this.localStorage().setItem(this.name+"-"+t.id,JSON.stringify(t)),e.include(this.records,t.id.toString())||this.records.push(t.id.toString()),this.save(),t.toJSON()},find:function(e){return JSON.parse(this.localStorage().getItem(this.name+"-"+e.id))},findAll:function(){return e(this.records).chain().map(function(e){return JSON.parse(this.localStorage().getItem(this.name+"-"+e))},this).compact
().value()},destroy:function(t){return this.localStorage().removeItem(this.name+"-"+t.id),this.records=e.reject(this.records,function(e){return e==t.id.toString()}),this.save(),t},localStorage:function(){return localStorage}}),t.LocalStorage.sync=window.Store.sync=t.localSync=function(e,t,n,r){var i=t.localStorage||t.collection.localStorage;typeof n=="function"&&(n={success:n,error:r});var s;switch(e){case"read":s=t.id!=undefined?i.find(t):i.findAll();break;case"create":s=i.create(t);break;case"update":s=i.update(t);break;case"delete":s=i.destroy(t)}s?n.success(s):n.error("Record not found")},t.ajaxSync=t.sync,t.getSyncMethod=function(e){return e.localStorage||e.collection&&e.collection.localStorage?t.localSync:t.ajaxSync},t.sync=function(e,n,r,i){return t.getSyncMethod(n).apply(this,[e,n,r,i])}}(),define("lib/backbone-localStorage",function(){}),define("models/Todo",["backbone","lib/backbone-localStorage"],function(e){return e.Model.extend({localStorage:new e.LocalStorage("todos-backbone"
),defaults:{title:"",completed:!1,created:0},initialize:function(){this.isNew()&&this.set("created",Date.now())},toggle:function(){return this.set("completed",!this.get("completed"))}})}),define("collections/TodoList",["backbone","models/Todo","lib/backbone-localStorage"],function(e,t){function n(e){return e.get("completed")}return e.Collection.extend({model:t,localStorage:new e.LocalStorage("todos-backbone"),getCompleted:function(){return this.filter(n)},getActive:function(){return this.reject(n)},comparator:function(e){return e.get("created")}})}),function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],t=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,n=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,r=[],i={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},s=function(e,t){var n=i,r="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(n.interpolate,function(e,t){return"',"+
t.replace(/\\'/g,"'")+",'"}).replace(n.evaluate||null,function(e,t){return"');"+t.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"; __p.push('"}).replace(/\r/g,"").replace(/\n/g,"").replace(/\t/g,"")+"');}return __p.join('');";return r};define("tpl",[],function(){var i,o,u;return typeof window!="undefined"&&window.navigator&&window.document?o=function(e,t){var n=i.createXhr();n.open("GET",e,!0),n.onreadystatechange=function(e){n.readyState===4&&t(n.responseText)},n.send(null)}:typeof process!="undefined"&&process.versions&&!!process.versions.node&&(u=require.nodeRequire("fs"),o=function(e,t){t(u.readFileSync(e,"utf8"))}),i={version:"0.24.0",strip:function(e){if(e){e=e.replace(t,"");var r=e.match(n);r&&(e=r[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"").replace(/[\t]/g,"").replace(/[\r]/g,"")},createXhr:function(){var t,n,r;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;for(
n=0;n<3;n++){r=e[n];try{t=new ActiveXObject(r)}catch(i){}if(t){e=[r];break}}if(!t)throw new Error("require.getXhr(): XMLHttpRequest not available");return t},get:o,load:function(e,t,n,o){var u=!1,a,f=e.indexOf("."),l=e.substring(0,f),c=e.substring(f+1,e.length);f=c.indexOf("!"),f!==-1&&(u=c.substring(f+1,c.length),u=u==="strip",c=c.substring(0,f)),a="nameToUrl"in t?t.nameToUrl(l,"."+c):t.toUrl(l+"."+c),i.get(a,function(t){t=s(t),o.isBuild||(t=new Function("obj",t)),t=u?i.strip(t):t,o.isBuild&&o.inlineText&&(r[e]=t),n(t)})},write:function(e,t,n){if(t in r){var s=i.jsEscape(r[t]);n("define('"+e+"!"+t+"', function() {return function(obj) { "+s.replace(/(\\')/g,"'").replace(/(\\\\)/g,"\\")+"}});\n")}}}})}(),define("tpl!templates/todoItemView.tmpl",function(){return function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div class="view">  <input class="toggle" type="checkbox" '),completed&&__p.push("checked"),__p.push(">    <label>",title,'</label>  <button class="destroy"></button></div><input class="edit" value="'
,title,'">');return __p.join("")}}),define("tpl!templates/todoListCompositeView.tmpl",function(){return function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<input id="toggle-all" type="checkbox"><label for="toggle-all">Mark all as complete</label><ul id="todo-list"></ul>');return __p.join("")}}),define("tpl!templates/footer.tmpl",function(){return function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<span id="todo-count"><strong></strong> items left</span><ul id="filters">  <li>    <a href="#/">All</a>  </li>  <li>    <a href="#/active">Active</a>  </li>  <li>    <a href="#/completed">Completed</a>  </li></ul><button id="clear-completed">Clear completed</button>');return __p.join("")}}),define("tpl!templates/header.tmpl",function(){return function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<h1>todos</h1><input id="new-todo" placeholder="What needs to be done?" autofocus>'
);return __p.join("")}}),define("templates",["require","tpl!templates/todoItemView.tmpl","tpl!templates/todoListCompositeView.tmpl","tpl!templates/footer.tmpl","tpl!templates/header.tmpl"],function(e){return{todoItemView:e("tpl!templates/todoItemView.tmpl"),todosCompositeView:e("tpl!templates/todoListCompositeView.tmpl"),footer:e("tpl!templates/footer.tmpl"),header:e("tpl!templates/header.tmpl")}}),define("views/Header",["marionette","templates"],function(e,t){return e.ItemView.extend({template:t.header,ui:{input:"#new-todo"},events:{"keypress #new-todo":"onInputKeypress"},onInputKeypress:function(e){var t=13,n=this.ui.input.val().trim();e.which===t&&n&&(this.collection.create({title:n}),this.ui.input.val(""))}})}),define("views/TodoItemView",["marionette","templates"],function(e,t){return e.CompositeView.extend({tagName:"li",template:t.todoItemView,ui:{edit:".edit"},events:{"click .destroy":"destroy","dblclick label":"onEditClick","keypress .edit":"onEditKeypress","click .toggle":"toggle"
},initialize:function(){this.bindTo(this.model,"change",this.render,this)},onRender:function(){this.$el.removeClass("active completed"),this.model.get("completed")?this.$el.addClass("completed"):this.$el.addClass("active")},destroy:function(){this.model.destroy()},toggle:function(){this.model.toggle().save()},onEditClick:function(){this.$el.addClass("editing"),this.ui.edit.focus()},onEditKeypress:function(e){var t=13,n=this.ui.edit.val().trim();e.which===t&&n&&(this.model.set("title",n).save(),this.$el.removeClass("editing"))}})}),define("views/TodoListCompositeView",["marionette","templates","vent","views/TodoItemView"],function(e,t,n,r){return e.CompositeView.extend({template:t.todosCompositeView,itemView:r,itemViewContainer:"#todo-list",ui:{toggle:"#toggle-all"},events:{"click #toggle-all":"onToggleAllClick"},initialize:function(){this.bindTo(this.collection,"all",this.updateToggleCheckbox,this)},onRender:function(){this.updateToggleCheckbox()},updateToggleCheckbox:function(){function e
(e,t){return e&&t.get("completed")}var t=this.collection.reduce(e,!0);this.ui.toggle.prop("checked",t)},onToggleAllClick:function(e){var t=e.currentTarget.checked;this.collection.each(function(e){e.save({completed:t})})}})}),define("views/ActiveCount",["marionette"],function(e){return e.View.extend({tagName:"span",initialize:function(){this.bindTo(this.collection,"all",this.render,this)},render:function(){this.$el.html(